<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>app &#8212; Ecommerce_FilfliJoe_AllamMansour 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for app</h1><div class="highlight"><pre>
<span></span><span class="c1"># app.py</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Ecommerce_FilfliJoe_AllamMansour Flask Application</span>
<span class="sd">===================================================</span>

<span class="sd">This module initializes and configures the Flask application, sets up the database,</span>
<span class="sd">JWT authentication, and defines the routes for managing customers, goods, purchases,</span>
<span class="sd">and reviews in the e-commerce platform.</span>

<span class="sd">Modules:</span>
<span class="sd">    - config: Configuration settings for the Flask app.</span>
<span class="sd">    - models: Database models for Customers, Goods, Purchases, and Reviews.</span>
<span class="sd">    - schemas: Marshmallow schemas for serializing and deserializing data.</span>

<span class="sd">Dependencies:</span>
<span class="sd">    - Flask: Web framework.</span>
<span class="sd">    - Flask_SQLAlchemy: ORM for database interactions.</span>
<span class="sd">    - Flask_JWT_Extended: JWT support for authentication.</span>
<span class="sd">    - Werkzeug: Security utilities for password hashing.</span>
<span class="sd">    - Marshmallow: Object serialization/deserialization.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>
<span class="kn">from</span> <span class="nn">flask_jwt_extended</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">JWTManager</span><span class="p">,</span> <span class="n">create_access_token</span><span class="p">,</span>
    <span class="n">jwt_required</span><span class="p">,</span> <span class="n">get_jwt_identity</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">werkzeug.security</span> <span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>
<span class="kn">import</span> <span class="nn">config</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">Customer</span><span class="p">,</span> <span class="n">Goods</span><span class="p">,</span> <span class="n">Purchase</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">schemas</span> <span class="kn">import</span> <span class="n">CustomerSchema</span><span class="p">,</span> <span class="n">GoodsSchema</span><span class="p">,</span> <span class="n">PurchaseSchema</span><span class="p">,</span> <span class="n">ReviewSchema</span>

<span class="c1"># Initialize Flask application</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">Config</span><span class="p">)</span>

<span class="c1"># Initialize extensions</span>
<span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">jwt</span> <span class="o">=</span> <span class="n">JWTManager</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="c1"># Initialize Marshmallow schemas</span>
<span class="n">customer_schema</span> <span class="o">=</span> <span class="n">CustomerSchema</span><span class="p">()</span>
<span class="n">customers_schema</span> <span class="o">=</span> <span class="n">CustomerSchema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">goods_schema</span> <span class="o">=</span> <span class="n">GoodsSchema</span><span class="p">()</span>
<span class="n">goods_list_schema</span> <span class="o">=</span> <span class="n">GoodsSchema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">purchase_schema</span> <span class="o">=</span> <span class="n">PurchaseSchema</span><span class="p">()</span>
<span class="n">purchases_schema</span> <span class="o">=</span> <span class="n">PurchaseSchema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">review_schema</span> <span class="o">=</span> <span class="n">ReviewSchema</span><span class="p">()</span>
<span class="n">reviews_schema</span> <span class="o">=</span> <span class="n">ReviewSchema</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="register_customer">
<a class="viewcode-back" href="../app.html#app.register_customer">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">register_customer</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a New Customer.</span>

<span class="sd">    This endpoint allows a new customer to register by providing necessary details.</span>
<span class="sd">    It validates the input data, hashes the password, and stores the customer in the database.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /customers/register</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;full_name&quot;: &quot;John Doe&quot;,</span>
<span class="sd">            &quot;username&quot;: &quot;johndoe&quot;,</span>
<span class="sd">            &quot;password&quot;: &quot;securepassword123&quot;,</span>
<span class="sd">            &quot;age&quot;: 30,</span>
<span class="sd">            &quot;address&quot;: &quot;123 Main St, Anytown, USA&quot;,</span>
<span class="sd">            &quot;gender&quot;: &quot;Male&quot;,                # Optional</span>
<span class="sd">            &quot;marital_status&quot;: &quot;Single&quot;       # Optional</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        201 Created:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Customer registered successfully.&quot;,</span>
<span class="sd">                &quot;customer_id&quot;: 1</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Username already exists.&quot;</span>
<span class="sd">            }</span>
<span class="sd">            Or validation errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">customer_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">400</span>

    <span class="k">if</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Username already exists.&#39;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
    <span class="n">new_customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="p">(</span>
        <span class="n">full_name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">],</span>
        <span class="n">username</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
        <span class="n">password</span><span class="o">=</span><span class="n">hashed_password</span><span class="p">,</span>
        <span class="n">age</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">],</span>
        <span class="n">address</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">],</span>
        <span class="n">gender</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">),</span>
        <span class="n">marital_status</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marital_status&#39;</span><span class="p">),</span>
        <span class="n">wallet_balance</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_customer</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer registered successfully.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;customer_id&#39;</span><span class="p">:</span> <span class="n">new_customer</span><span class="o">.</span><span class="n">id</span>
    <span class="p">}),</span> <span class="mi">201</span></div>



<div class="viewcode-block" id="login">
<a class="viewcode-back" href="../app.html#app.login">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authenticate a Customer and Provide a JWT Token.</span>

<span class="sd">    This endpoint authenticates a customer using their username and password.</span>
<span class="sd">    Upon successful authentication, it returns a JWT access token for authorized access.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /customers/login</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;username&quot;: &quot;johndoe&quot;,</span>
<span class="sd">            &quot;password&quot;: &quot;securepassword123&quot;</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;access_token&quot;: &quot;jwt_token_here&quot;</span>
<span class="sd">            }</span>
<span class="sd">        401 Unauthorized:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Invalid username or password.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">customer</span> <span class="ow">and</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">customer</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">create_access_token</span><span class="p">(</span><span class="n">identity</span><span class="o">=</span><span class="n">customer</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">),</span> <span class="mi">200</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid username or password.&#39;</span><span class="p">}),</span> <span class="mi">401</span></div>



<div class="viewcode-block" id="delete_customer">
<a class="viewcode-back" href="../app.html#app.delete_customer">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/&lt;string:username&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">delete_customer</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a Customer Account.</span>

<span class="sd">    This endpoint allows a customer to delete their own account. It ensures that the</span>
<span class="sd">    request is made by the account owner.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        DELETE /customers/&lt;username&gt;</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to the customer being deleted.</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Customer deleted successfully.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">current_username</span> <span class="o">!=</span> <span class="n">username</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer deleted successfully.&#39;</span><span class="p">}),</span> <span class="mi">200</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span></div>



<div class="viewcode-block" id="update_customer">
<a class="viewcode-back" href="../app.html#app.update_customer">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/&lt;string:username&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">update_customer</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update Customer Information.</span>

<span class="sd">    This endpoint allows a customer to update their own information. It ensures that the</span>
<span class="sd">    request is made by the account owner.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        PUT /customers/&lt;username&gt;</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to the customer being updated.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;full_name&quot;: &quot;Jane Doe&quot;,           # Optional</span>
<span class="sd">            &quot;age&quot;: 31,                          # Optional</span>
<span class="sd">            &quot;address&quot;: &quot;456 Elm St, Othertown&quot;,# Optional</span>
<span class="sd">            &quot;gender&quot;: &quot;Female&quot;,                 # Optional</span>
<span class="sd">            &quot;marital_status&quot;: &quot;Married&quot;         # Optional</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Customer information updated successfully.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">current_username</span> <span class="o">!=</span> <span class="n">username</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;full_name&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">customer</span><span class="o">.</span><span class="n">full_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">customer</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;address&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">customer</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;gender&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">customer</span><span class="o">.</span><span class="n">gender</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;marital_status&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">customer</span><span class="o">.</span><span class="n">marital_status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;marital_status&#39;</span><span class="p">]</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer information updated successfully.&#39;</span><span class="p">}),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="get_all_customers">
<a class="viewcode-back" href="../app.html#app.get_all_customers">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_all_customers</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve All Customers.</span>

<span class="sd">    This endpoint allows an admin user to retrieve a list of all customers in the system.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /customers</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;full_name&quot;: &quot;John Doe&quot;,</span>
<span class="sd">                    &quot;username&quot;: &quot;johndoe&quot;,</span>
<span class="sd">                    &quot;age&quot;: 30,</span>
<span class="sd">                    &quot;address&quot;: &quot;123 Main St, Anytown, USA&quot;,</span>
<span class="sd">                    &quot;gender&quot;: &quot;Male&quot;,</span>
<span class="sd">                    &quot;marital_status&quot;: &quot;Single&quot;,</span>
<span class="sd">                    &quot;wallet_balance&quot;: 0.0,</span>
<span class="sd">                    &quot;is_admin&quot;: false</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_user</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="c1"># Assuming you have an &#39;is_admin&#39; field in your customer model</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_user</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>
    <span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">customers_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="get_customer">
<a class="viewcode-back" href="../app.html#app.get_customer">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/&lt;string:username&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_customer</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a Specific Customer&#39;s Details.</span>

<span class="sd">    This endpoint allows a customer to retrieve their own details.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /customers/&lt;username&gt;</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to the customer being retrieved.</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;id&quot;: 1,</span>
<span class="sd">                &quot;full_name&quot;: &quot;John Doe&quot;,</span>
<span class="sd">                &quot;username&quot;: &quot;johndoe&quot;,</span>
<span class="sd">                &quot;age&quot;: 30,</span>
<span class="sd">                &quot;address&quot;: &quot;123 Main St, Anytown, USA&quot;,</span>
<span class="sd">                &quot;gender&quot;: &quot;Male&quot;,</span>
<span class="sd">                &quot;marital_status&quot;: &quot;Single&quot;,</span>
<span class="sd">                &quot;wallet_balance&quot;: 0.0,</span>
<span class="sd">                &quot;is_admin&quot;: false</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">current_username</span> <span class="o">!=</span> <span class="n">username</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">customer_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span></div>



<div class="viewcode-block" id="charge_wallet">
<a class="viewcode-back" href="../app.html#app.charge_wallet">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/&lt;string:username&gt;/wallet/charge&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">charge_wallet</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Charge a Customer&#39;s Wallet.</span>

<span class="sd">    This endpoint allows an admin to add funds to a customer&#39;s wallet.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /customers/&lt;username&gt;/wallet/charge</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;amount&quot;: 50.0</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;$50.0 has been added to johndoe&#39;s wallet.&quot;,</span>
<span class="sd">                &quot;wallet_balance&quot;: 50.0</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Invalid amount.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">amount</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid amount.&#39;</span><span class="p">}),</span> <span class="mi">400</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span> <span class="o">+=</span> <span class="n">amount</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s1"> has been added to </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">s wallet.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;wallet_balance&#39;</span><span class="p">:</span> <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span>
        <span class="p">}),</span> <span class="mi">200</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span></div>



<div class="viewcode-block" id="deduct_wallet">
<a class="viewcode-back" href="../app.html#app.deduct_wallet">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/&lt;string:username&gt;/wallet/deduct&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">deduct_wallet</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deduct Funds from a Customer&#39;s Wallet.</span>

<span class="sd">    This endpoint allows an admin to deduct funds from a customer&#39;s wallet.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /customers/&lt;username&gt;/wallet/deduct</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;amount&quot;: 20.0</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;$20.0 has been deducted from johndoe&#39;s wallet.&quot;,</span>
<span class="sd">                &quot;wallet_balance&quot;: 30.0</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Invalid amount.&quot;</span>
<span class="sd">            }</span>
<span class="sd">            Or</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Insufficient wallet balance.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">amount</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid amount.&#39;</span><span class="p">}),</span> <span class="mi">400</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">:</span>
            <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span> <span class="o">-=</span> <span class="n">amount</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s1"> has been deducted from </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">s wallet.&#39;</span><span class="p">,</span>
                <span class="s1">&#39;wallet_balance&#39;</span><span class="p">:</span> <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span>
            <span class="p">}),</span> <span class="mi">200</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Insufficient wallet balance.&#39;</span><span class="p">}),</span> <span class="mi">400</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span></div>



<div class="viewcode-block" id="add_goods">
<a class="viewcode-back" href="../app.html#app.add_goods">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/goods&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add_goods</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add New Goods to the Inventory.</span>

<span class="sd">    This endpoint allows an admin user to add new goods to the inventory by providing</span>
<span class="sd">    necessary details.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /goods</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;name&quot;: &quot;Laptop&quot;,</span>
<span class="sd">            &quot;category&quot;: &quot;electronics&quot;,</span>
<span class="sd">            &quot;price_per_item&quot;: 999.99,</span>
<span class="sd">            &quot;description&quot;: &quot;A high-end gaming laptop.&quot;,</span>
<span class="sd">            &quot;count_in_stock&quot;: 10</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        201 Created:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Goods added successfully.&quot;,</span>
<span class="sd">                &quot;goods_id&quot;: 1</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Validation errors.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">goods_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">400</span>

    <span class="n">new_goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="n">category</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">],</span>
        <span class="n">price_per_item</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;price_per_item&#39;</span><span class="p">],</span>
        <span class="n">description</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">count_in_stock</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;count_in_stock&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_goods</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods added successfully.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;goods_id&#39;</span><span class="p">:</span> <span class="n">new_goods</span><span class="o">.</span><span class="n">id</span>
    <span class="p">}),</span> <span class="mi">201</span></div>



<div class="viewcode-block" id="update_goods">
<a class="viewcode-back" href="../app.html#app.update_goods">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/goods/&lt;int:goods_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">update_goods</span><span class="p">(</span><span class="n">goods_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update Existing Goods Information.</span>

<span class="sd">    This endpoint allows an admin user to update details of existing goods in the inventory.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        PUT /goods/&lt;goods_id&gt;</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;name&quot;: &quot;Gaming Laptop&quot;,              # Optional</span>
<span class="sd">            &quot;category&quot;: &quot;electronics&quot;,            # Optional</span>
<span class="sd">            &quot;price_per_item&quot;: 1099.99,            # Optional</span>
<span class="sd">            &quot;description&quot;: &quot;An upgraded gaming laptop.&quot;, # Optional</span>
<span class="sd">            &quot;count_in_stock&quot;: 8                    # Optional</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Goods updated successfully.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Validation errors.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Goods not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">goods_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">400</span>

    <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">goods</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;category&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">goods</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;price_per_item&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">goods</span><span class="o">.</span><span class="n">price_per_item</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;price_per_item&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">goods</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;count_in_stock&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">goods</span><span class="o">.</span><span class="n">count_in_stock</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;count_in_stock&#39;</span><span class="p">]</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods updated successfully.&#39;</span><span class="p">}),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="deduct_goods">
<a class="viewcode-back" href="../app.html#app.deduct_goods">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/goods/&lt;int:goods_id&gt;/deduct&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">deduct_goods</span><span class="p">(</span><span class="n">goods_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deduct Items from Goods Stock.</span>

<span class="sd">    This endpoint allows an admin user to deduct a specified number of items from a goods&#39; stock.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /goods/&lt;goods_id&gt;/deduct</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;amount&quot;: 2</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;2 items deducted from stock.&quot;,</span>
<span class="sd">                &quot;count_in_stock&quot;: 8</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Invalid amount to deduct.&quot;</span>
<span class="sd">            }</span>
<span class="sd">            Or</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Not enough items in stock to deduct.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Goods not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid amount to deduct.&#39;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="k">if</span> <span class="n">goods</span><span class="o">.</span><span class="n">count_in_stock</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">:</span>
        <span class="n">goods</span><span class="o">.</span><span class="n">count_in_stock</span> <span class="o">-=</span> <span class="n">amount</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s1"> items deducted from stock.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;count_in_stock&#39;</span><span class="p">:</span> <span class="n">goods</span><span class="o">.</span><span class="n">count_in_stock</span>
        <span class="p">}),</span> <span class="mi">200</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Not enough items in stock to deduct.&#39;</span><span class="p">}),</span> <span class="mi">400</span></div>



<div class="viewcode-block" id="delete_goods">
<a class="viewcode-back" href="../app.html#app.delete_goods">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/goods/&lt;int:goods_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">delete_goods</span><span class="p">(</span><span class="n">goods_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a Goods Item.</span>

<span class="sd">    This endpoint allows an admin user to delete a goods item from the inventory.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        DELETE /goods/&lt;goods_id&gt;</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Goods deleted successfully.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Goods not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">goods</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods deleted successfully.&#39;</span><span class="p">}),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="get_all_goods">
<a class="viewcode-back" href="../app.html#app.get_all_goods">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/goods&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_all_goods</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve All Goods.</span>

<span class="sd">    This endpoint allows any user to retrieve a list of all goods available in the inventory.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /goods</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;name&quot;: &quot;Laptop&quot;,</span>
<span class="sd">                    &quot;category&quot;: &quot;electronics&quot;,</span>
<span class="sd">                    &quot;price_per_item&quot;: 999.99,</span>
<span class="sd">                    &quot;description&quot;: &quot;A high-end gaming laptop.&quot;,</span>
<span class="sd">                    &quot;count_in_stock&quot;: 10</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">goods_list</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">goods_list_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">goods_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="get_goods">
<a class="viewcode-back" href="../app.html#app.get_goods">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/goods/&lt;int:goods_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_goods</span><span class="p">(</span><span class="n">goods_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve Specific Goods Details.</span>

<span class="sd">    This endpoint allows any user to retrieve details of a specific goods item by its ID.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /goods/&lt;goods_id&gt;</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;id&quot;: 1,</span>
<span class="sd">                &quot;name&quot;: &quot;Laptop&quot;,</span>
<span class="sd">                &quot;category&quot;: &quot;electronics&quot;,</span>
<span class="sd">                &quot;price_per_item&quot;: 999.99,</span>
<span class="sd">                &quot;description&quot;: &quot;A high-end gaming laptop.&quot;,</span>
<span class="sd">                &quot;count_in_stock&quot;: 10</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Goods not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">goods_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">goods</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="make_sale">
<a class="viewcode-back" href="../app.html#app.make_sale">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/sales&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">make_sale</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a Sale Purchase.</span>

<span class="sd">    This endpoint allows a customer to make a purchase of goods. It ensures sufficient stock</span>
<span class="sd">    and wallet balance before completing the transaction.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /sales</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;goods_id&quot;: 1,</span>
<span class="sd">            &quot;quantity&quot;: 2</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        201 Created:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Purchase successful.&quot;,</span>
<span class="sd">                &quot;purchase_id&quot;: 1,</span>
<span class="sd">                &quot;wallet_balance&quot;: 980.02</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Not enough items in stock.&quot;</span>
<span class="sd">            }</span>
<span class="sd">            Or</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Insufficient funds in wallet.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">            Or</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Goods not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">goods_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;goods_id&#39;</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods ID is required.&#39;</span><span class="p">}),</span> <span class="mi">400</span>
    <span class="k">if</span> <span class="n">quantity</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Quantity must be at least 1.&#39;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="n">goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="k">if</span> <span class="n">goods</span><span class="o">.</span><span class="n">count_in_stock</span> <span class="o">&lt;</span> <span class="n">quantity</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Not enough items in stock.&#39;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="n">total_price</span> <span class="o">=</span> <span class="n">goods</span><span class="o">.</span><span class="n">price_per_item</span> <span class="o">*</span> <span class="n">quantity</span>
    <span class="k">if</span> <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span> <span class="o">&lt;</span> <span class="n">total_price</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Insufficient funds in wallet.&#39;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="c1"># Deduct money from customer&#39;s wallet</span>
    <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span> <span class="o">-=</span> <span class="n">total_price</span>

    <span class="c1"># Decrease count of purchased goods</span>
    <span class="n">goods</span><span class="o">.</span><span class="n">count_in_stock</span> <span class="o">-=</span> <span class="n">quantity</span>

    <span class="c1"># Record the purchase</span>
    <span class="n">new_purchase</span> <span class="o">=</span> <span class="n">Purchase</span><span class="p">(</span>
        <span class="n">customer_id</span><span class="o">=</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">goods_id</span><span class="o">=</span><span class="n">goods</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
        <span class="n">total_price</span><span class="o">=</span><span class="n">total_price</span><span class="p">,</span>
        <span class="n">purchase_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_purchase</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Purchase successful.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;purchase_id&#39;</span><span class="p">:</span> <span class="n">new_purchase</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s1">&#39;wallet_balance&#39;</span><span class="p">:</span> <span class="n">customer</span><span class="o">.</span><span class="n">wallet_balance</span>
    <span class="p">}),</span> <span class="mi">201</span></div>



<div class="viewcode-block" id="get_purchase_history">
<a class="viewcode-back" href="../app.html#app.get_purchase_history">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/&lt;string:username&gt;/purchases&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_purchase_history</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a Customer&#39;s Purchase History.</span>

<span class="sd">    This endpoint allows a customer to retrieve their own purchase history.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /customers/&lt;username&gt;/purchases</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to the customer whose history is being retrieved.</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;customer_id&quot;: 1,</span>
<span class="sd">                    &quot;goods_id&quot;: 2,</span>
<span class="sd">                    &quot;quantity&quot;: 3,</span>
<span class="sd">                    &quot;total_price&quot;: 59.97,</span>
<span class="sd">                    &quot;purchase_date&quot;: &quot;2024-12-03T12:34:56Z&quot;</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">current_username</span> <span class="o">!=</span> <span class="n">username</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">purchases</span> <span class="o">=</span> <span class="n">Purchase</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">purchases_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">purchases</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="submit_review">
<a class="viewcode-back" href="../app.html#app.submit_review">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/reviews&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">submit_review</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Submit a Review for a Goods Item.</span>

<span class="sd">    This endpoint allows a customer to submit a review for a specific goods item.</span>
<span class="sd">    It ensures that the customer has not already reviewed the same item.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /reviews</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;goods_id&quot;: 1,</span>
<span class="sd">            &quot;rating&quot;: 5,</span>
<span class="sd">            &quot;comment&quot;: &quot;Excellent product!&quot;</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        201 Created:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Review submitted successfully.&quot;,</span>
<span class="sd">                &quot;review&quot;: {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;customer_id&quot;: 1,</span>
<span class="sd">                    &quot;goods_id&quot;: 1,</span>
<span class="sd">                    &quot;rating&quot;: 5,</span>
<span class="sd">                    &quot;comment&quot;: &quot;Excellent product!&quot;,</span>
<span class="sd">                    &quot;created_at&quot;: &quot;2024-12-03T12:34:56Z&quot;,</span>
<span class="sd">                    &quot;is_moderated&quot;: false</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;You have already reviewed this product.&quot;</span>
<span class="sd">            }</span>
<span class="sd">            Or validation errors.</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Goods not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">review_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">400</span>

    <span class="n">goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;goods_id&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="c1"># Check if customer has already reviewed this product</span>
    <span class="n">existing_review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">goods_id</span><span class="o">=</span><span class="n">goods</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">existing_review</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;You have already reviewed this product.&#39;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="n">new_review</span> <span class="o">=</span> <span class="n">Review</span><span class="p">(</span>
        <span class="n">customer_id</span><span class="o">=</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">goods_id</span><span class="o">=</span><span class="n">goods</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">rating</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">],</span>
        <span class="n">comment</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
        <span class="n">is_moderated</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_review</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Review submitted successfully.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;review&#39;</span><span class="p">:</span> <span class="n">review_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">new_review</span><span class="p">)</span>
    <span class="p">}),</span> <span class="mi">201</span></div>



<div class="viewcode-block" id="update_review">
<a class="viewcode-back" href="../app.html#app.update_review">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/reviews/&lt;int:review_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">update_review</span><span class="p">(</span><span class="n">review_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an Existing Review.</span>

<span class="sd">    This endpoint allows a customer to update their own review. Admins can update any review.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        PUT /reviews/&lt;review_id&gt;</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - If the requester is not an admin, they can only update their own reviews.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;rating&quot;: 4,                      # Optional</span>
<span class="sd">            &quot;comment&quot;: &quot;Updated comment.&quot;     # Optional</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Review updated successfully.&quot;,</span>
<span class="sd">                &quot;review&quot;: {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;customer_id&quot;: 1,</span>
<span class="sd">                    &quot;goods_id&quot;: 1,</span>
<span class="sd">                    &quot;rating&quot;: 4,</span>
<span class="sd">                    &quot;comment&quot;: &quot;Updated comment.&quot;,</span>
<span class="sd">                    &quot;created_at&quot;: &quot;2024-12-03T12:34:56Z&quot;,</span>
<span class="sd">                    &quot;is_moderated&quot;: false</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;You can only update your own reviews.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Validation errors.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Review not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">review_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">review</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Review not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="c1"># Check if the requester is the owner of the review or an admin</span>
    <span class="k">if</span> <span class="n">review</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">!=</span> <span class="n">customer</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;You can only update your own reviews.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">review_schema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">partial</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span> <span class="mi">400</span>

    <span class="k">if</span> <span class="s1">&#39;rating&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">review</span><span class="o">.</span><span class="n">rating</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;comment&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">review</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Review updated successfully.&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">:</span> <span class="n">review_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">review</span><span class="p">)}),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="delete_review">
<a class="viewcode-back" href="../app.html#app.delete_review">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/reviews/&lt;int:review_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DELETE&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">delete_review</span><span class="p">(</span><span class="n">review_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a Review.</span>

<span class="sd">    This endpoint allows a customer to delete their own review or an admin to delete any review.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        DELETE /reviews/&lt;review_id&gt;</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - If the requester is not an admin, they can only delete their own reviews.</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Review deleted successfully.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;You are not authorized to delete this review.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Review not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">review_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">review</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Review not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="c1"># Check if the requester is the owner of the review or an admin</span>
    <span class="k">if</span> <span class="n">review</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">!=</span> <span class="n">customer</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">customer</span><span class="o">.</span><span class="n">is_admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;You are not authorized to delete this review.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Review deleted successfully.&#39;</span><span class="p">}),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="get_product_reviews">
<a class="viewcode-back" href="../app.html#app.get_product_reviews">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/goods/&lt;int:goods_id&gt;/reviews&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_product_reviews</span><span class="p">(</span><span class="n">goods_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve Reviews for a Specific Goods Item.</span>

<span class="sd">    This endpoint allows any user to retrieve all reviews associated with a specific goods item.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /goods/&lt;goods_id&gt;/reviews</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;customer_id&quot;: 1,</span>
<span class="sd">                    &quot;goods_id&quot;: 1,</span>
<span class="sd">                    &quot;rating&quot;: 5,</span>
<span class="sd">                    &quot;comment&quot;: &quot;Excellent product!&quot;,</span>
<span class="sd">                    &quot;created_at&quot;: &quot;2024-12-03T12:34:56Z&quot;,</span>
<span class="sd">                    &quot;is_moderated&quot;: false</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Goods not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">goods</span> <span class="o">=</span> <span class="n">Goods</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">goods_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goods</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Goods not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">reviews</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">goods_id</span><span class="o">=</span><span class="n">goods_id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">reviews_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="get_customer_reviews">
<a class="viewcode-back" href="../app.html#app.get_customer_reviews">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/customers/&lt;string:username&gt;/reviews&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_customer_reviews</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a Customer&#39;s Reviews.</span>

<span class="sd">    This endpoint allows a customer to retrieve all reviews they have submitted. Admins can retrieve any customer&#39;s reviews.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /customers/&lt;username&gt;/reviews</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - If the requester is not an admin, they can only retrieve their own reviews.</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: 1,</span>
<span class="sd">                    &quot;customer_id&quot;: 1,</span>
<span class="sd">                    &quot;goods_id&quot;: 1,</span>
<span class="sd">                    &quot;rating&quot;: 5,</span>
<span class="sd">                    &quot;comment&quot;: &quot;Excellent product!&quot;,</span>
<span class="sd">                    &quot;created_at&quot;: &quot;2024-12-03T12:34:56Z&quot;,</span>
<span class="sd">                    &quot;is_moderated&quot;: false</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Unauthorized access.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Customer not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">current_username</span> <span class="o">!=</span> <span class="n">username</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">,</span> <span class="n">is_admin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Unauthorized access.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">customer</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Customer not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">reviews</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">reviews_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">reviews</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="moderate_review">
<a class="viewcode-back" href="../app.html#app.moderate_review">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/reviews/&lt;int:review_id&gt;/moderate&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="nd">@jwt_required</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">moderate_review</span><span class="p">(</span><span class="n">review_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Moderate a Review.</span>

<span class="sd">    This endpoint allows an admin user to approve or flag a review.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        POST /reviews/&lt;review_id&gt;/moderate</span>

<span class="sd">    **Authentication:**</span>
<span class="sd">        - JWT token required.</span>
<span class="sd">        - Token must belong to an admin user.</span>

<span class="sd">    **Request JSON:**</span>
<span class="sd">        {</span>
<span class="sd">            &quot;action&quot;: &quot;approve&quot;   # Or &quot;flag&quot;</span>
<span class="sd">        }</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Review has been approved.&quot;</span>
<span class="sd">            }</span>
<span class="sd">            Or</span>
<span class="sd">            {</span>
<span class="sd">                &quot;message&quot;: &quot;Review has been flagged.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        400 Bad Request:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Invalid action. Use \&quot;approve\&quot; or \&quot;flag\&quot;.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        403 Forbidden:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Only administrators can moderate reviews.&quot;</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Review not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_username</span> <span class="o">=</span> <span class="n">get_jwt_identity</span><span class="p">()</span>
    <span class="n">admin</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">current_username</span><span class="p">,</span> <span class="n">is_admin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">admin</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Only administrators can moderate reviews.&#39;</span><span class="p">}),</span> <span class="mi">403</span>

    <span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">review_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">review</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Review not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;approve&#39;</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid action. Use &quot;approve&quot; or &quot;flag&quot;.&#39;</span><span class="p">}),</span> <span class="mi">400</span>

    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;approve&#39;</span><span class="p">:</span>
        <span class="n">review</span><span class="o">.</span><span class="n">is_moderated</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;flag&#39;</span><span class="p">:</span>
        <span class="n">review</span><span class="o">.</span><span class="n">is_moderated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Review has been </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s1">d.&#39;</span><span class="p">}),</span> <span class="mi">200</span></div>



<div class="viewcode-block" id="get_review_details">
<a class="viewcode-back" href="../app.html#app.get_review_details">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/reviews/&lt;int:review_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_review_details</span><span class="p">(</span><span class="n">review_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve Details of a Specific Review.</span>

<span class="sd">    This endpoint allows any user to retrieve detailed information about a specific review.</span>

<span class="sd">    **Endpoint:**</span>
<span class="sd">        GET /reviews/&lt;review_id&gt;</span>

<span class="sd">    **Responses:**</span>
<span class="sd">        200 OK:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;id&quot;: 1,</span>
<span class="sd">                &quot;customer_id&quot;: 1,</span>
<span class="sd">                &quot;goods_id&quot;: 1,</span>
<span class="sd">                &quot;rating&quot;: 5,</span>
<span class="sd">                &quot;comment&quot;: &quot;Excellent product!&quot;,</span>
<span class="sd">                &quot;created_at&quot;: &quot;2024-12-03T12:34:56Z&quot;,</span>
<span class="sd">                &quot;is_moderated&quot;: false</span>
<span class="sd">            }</span>
<span class="sd">        404 Not Found:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;error&quot;: &quot;Review not found.&quot;</span>
<span class="sd">            }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">review_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">review</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Review not found.&#39;</span><span class="p">}),</span> <span class="mi">404</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">review_schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="mi">200</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the Flask Application.</span>

<span class="sd">    This entry point starts the Flask development server with debugging enabled.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Ecommerce_FilfliJoe_AllamMansour</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../app.html">App Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Config Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models.html">Models Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schemas.html">Schemas Module</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>